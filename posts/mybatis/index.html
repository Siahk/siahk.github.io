<!doctype html><html lang=en><head>
<meta name=generator content="Hugo 0.88.1">
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta property="og:title" content="Mybatis">
<meta name=keywords content="hugo,vitae,theme,static,blog"><meta name=description content="环境  JDK1.8 Mysql 5.7 Maven 3.6.1 IDEA  回顾  JDBC Mysql Java 基础 Maven Junit  SSM 框架：配置文件的，最好的方式：看官方文档
1 简介 1.1 什么是Mybatis  MyBatis 是一款优秀的持久层框 …"><meta property="og:title" content="Mybatis">
<meta property="og:description" content="环境  JDK1.8 Mysql 5.7 Maven 3.6.1 IDEA  回顾  JDBC Mysql Java 基础 Maven Junit  SSM 框架：配置文件的，最好的方式：看官方文档
1 简介 1.1 什么是Mybatis  MyBatis 是一款优秀的持久层框架。 它支持自定义 SQL、存储过程以及高级映射。 MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。 MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。  1.2 持久层 数据持久化
 持久化是将程序数据在持久状态和瞬时状态间转换的机制。通俗的讲，就是瞬时数据（比如内存中的数据，是不能永久保存的）持久化为持久数据（比如持久化至数据库中，能够长久保存）。 内存：断电即失 数据库（JDBC），io文件持久化。 生活：冷藏.罐头  为什么需要持久化
 有一些对象，不能让它丢掉 内存太贵  1.3 持久层 Dao层、Serveice层、Controller层……
 完成持久化工作的代码块 层界限十分明显  1.4 什么么需要Mybatis  帮助程序员将数据存入到数据库中 方便 传统的JDBC代码太复杂，简化 不用Mybatis也可以，更容易上手，技术没有高低之分 优点：  简单易学 灵活 sql和代码的分离，提高了可维护性 提供映射标签，支持对象和数据库的orm字段关系映射 提供对象关系映射标签，支持对象关系组建维护。 提供xml标签，支持编写动态sql    最重要的一点：使用的人多">
<meta property="og:type" content="article">
<meta property="og:url" content="http://siahk.github.io/posts/mybatis/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-03-31T13:38:44+08:00">
<meta property="article:modified_time" content="2021-03-31T13:38:44+08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Mybatis">
<meta name=twitter:description content="环境  JDK1.8 Mysql 5.7 Maven 3.6.1 IDEA  回顾  JDBC Mysql Java 基础 Maven Junit  SSM 框架：配置文件的，最好的方式：看官方文档
1 简介 1.1 什么是Mybatis  MyBatis 是一款优秀的持久层框架。 它支持自定义 SQL、存储过程以及高级映射。 MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。 MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。  1.2 持久层 数据持久化
 持久化是将程序数据在持久状态和瞬时状态间转换的机制。通俗的讲，就是瞬时数据（比如内存中的数据，是不能永久保存的）持久化为持久数据（比如持久化至数据库中，能够长久保存）。 内存：断电即失 数据库（JDBC），io文件持久化。 生活：冷藏.罐头  为什么需要持久化
 有一些对象，不能让它丢掉 内存太贵  1.3 持久层 Dao层、Serveice层、Controller层……
 完成持久化工作的代码块 层界限十分明显  1.4 什么么需要Mybatis  帮助程序员将数据存入到数据库中 方便 传统的JDBC代码太复杂，简化 不用Mybatis也可以，更容易上手，技术没有高低之分 优点：  简单易学 灵活 sql和代码的分离，提高了可维护性 提供映射标签，支持对象和数据库的orm字段关系映射 提供对象关系映射标签，支持对象关系组建维护。 提供xml标签，支持编写动态sql    最重要的一点：使用的人多">
<link rel=stylesheet type=text/css media=screen href=/css/normalize.css>
<link rel=stylesheet type=text/css media=screen href=/css/main.css>
<link rel=stylesheet type=text/css media=screen href=/css/all.css>
<link rel=stylesheet href=/css/katex.min.css crossorigin=anonymous>
<script defer src=/js/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script>
<script defer src=/js/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script><title>Mybatis | Siahk'Blog</title>
</head>
<body><header>
<div id=titletext><h2 id=title><a href=http://siahk.github.io/>Siahk'Blog</a></h2></div>
<div id=title-description><p id=subtitle>Later equals never.</p><div id=social>
<nav>
<ul>
<li><a href=https://github.com/Siahk><i title=Github class="icons fab fa-github"></i></a></li>
<li><a href=/index.xml><i title=RSS class="icons fas fa-rss"></i></a></li></ul>
</nav>
</div>
</div>
<div id=mainmenu>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Blogs</a></li>
<li><a href=/about>About</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/categories>Categories</a></li>
</ul>
</nav>
</div>
</header>
<main><div class=post>
<div class=author>
</div>
<div class=post-header>
<div class=meta>
<div class=date>
<span class=day>31</span>
<span class=rest>Mar 2021</span>
</div>
</div>
<div class=matter>
<h1 class=title>Mybatis</h1>
</div>
</div>
<div class=markdown>
<h3 id=环境>环境</h3>
<ul>
<li>JDK1.8</li>
<li>Mysql 5.7</li>
<li>Maven 3.6.1</li>
<li>IDEA</li>
</ul>
<h3 id=回顾>回顾</h3>
<ul>
<li>JDBC</li>
<li>Mysql</li>
<li>Java 基础</li>
<li>Maven</li>
<li>Junit</li>
</ul>
<p>SSM 框架：配置文件的，最好的方式：看官方文档</p>
<h1 id=1-简介>1 简介</h1>
<h2 id=11-什么是mybatis>1.1 什么是Mybatis</h2>
<ul>
<li>MyBatis 是一款优秀的<strong>持久层框架</strong>。</li>
<li>它支持自定义 SQL、存储过程以及高级映射。</li>
<li>MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。</li>
<li>MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</li>
</ul>
<h2 id=12-持久层>1.2 持久层</h2>
<p>数据持久化</p>
<ul>
<li>持久化是将程序数据在持久状态和瞬时状态间转换的机制。通俗的讲，就是瞬时数据（比如内存中的数据，是不能永久保存的）持久化为持久数据（比如持久化至数据库中，能够长久保存）。</li>
<li>内存：<strong>断电即失</strong></li>
<li>数据库（JDBC），io文件持久化。</li>
<li>生活：冷藏.罐头</li>
</ul>
<p><strong>为什么需要持久化</strong></p>
<ul>
<li>有一些对象，不能让它丢掉</li>
<li>内存太贵</li>
</ul>
<h2 id=13-持久层>1.3 持久层</h2>
<p>Dao层、Serveice层、Controller层……</p>
<ul>
<li>完成持久化工作的代码块</li>
<li>层界限十分明显</li>
</ul>
<h2 id=14-什么么需要mybatis>1.4 什么么需要Mybatis</h2>
<ul>
<li>帮助程序员将数据存入到数据库中</li>
<li>方便</li>
<li>传统的JDBC代码太复杂，简化</li>
<li>不用Mybatis也可以，更容易上手，技术没有高低之分</li>
<li>优点：
<ul>
<li>简单易学</li>
<li>灵活</li>
<li>sql和代码的分离，提高了可维护性</li>
<li>提供映射标签，支持对象和数据库的orm字段关系映射</li>
<li>提供对象关系映射标签，支持对象关系组建维护。</li>
<li>提供xml标签，支持编写动态sql</li>
</ul>
</li>
</ul>
<p><strong>最重要的一点：使用的人多</strong></p>
<p>Spring SpringMVC SpringBoot</p>
<h1 id=2-第一个mybatis程序>2 第一个Mybatis程序</h1>
<p>思路：搭建环境->Mybatis->编写代码->测试！</p>
<h2 id=21-搭建环境>2.1 搭建环境</h2>
<p>搭建数据库</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>USE<span style=color:#bbb> </span>demo_siahk;<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#080;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=background-color:#fff0f0>&#39;user&#39;</span>(<span style=color:#bbb>
</span><span style=color:#bbb>	</span><span style=background-color:#fff0f0>&#39;id&#39;</span><span style=color:#bbb> </span><span style=color:#007020>INT</span>(<span style=color:#00d;font-weight:700>20</span>)<span style=color:#bbb> </span><span style=color:#080;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#080;font-weight:700>NULL</span><span style=color:#bbb> </span><span style=color:#080;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:#080;font-weight:700>KEY</span>,<span style=color:#bbb>
</span><span style=color:#bbb>	</span><span style=background-color:#fff0f0>&#39;naem&#39;</span><span style=color:#bbb> </span><span style=color:#007020>VARCHAR</span>(<span style=color:#00d;font-weight:700>30</span>)<span style=color:#bbb> </span><span style=color:#080;font-weight:700>DEFAULT</span><span style=color:#bbb> </span><span style=color:#080;font-weight:700>NULL</span>,<span style=color:#bbb>
</span><span style=color:#bbb>	</span><span style=background-color:#fff0f0>&#39;pwd&#39;</span><span style=color:#bbb> </span><span style=color:#007020>VARCHAR</span>(<span style=color:#00d;font-weight:700>30</span>)<span style=color:#bbb> </span><span style=color:#080;font-weight:700>DEFAULT</span><span style=color:#bbb> </span><span style=color:#080;font-weight:700>NULL</span><span style=color:#bbb>
</span><span style=color:#bbb></span>)<span style=color:#bbb> 
</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>INSERT</span><span style=color:#bbb> </span><span style=color:#080;font-weight:700>INTO</span><span style=color:#bbb> </span><span style=color:#333>`</span><span style=color:#080;font-weight:700>user</span><span style=color:#333>`</span><span style=color:#bbb> </span>(id,<span style=color:#bbb> </span>name,<span style=color:#bbb> </span>pwd)<span style=color:#bbb> </span><span style=color:#080;font-weight:700>VALUES</span><span style=color:#bbb> </span>(<span style=color:#00d;font-weight:700>1</span>,<span style=color:#bbb> </span><span style=background-color:#fff0f0>&#39;王五&#39;</span>,<span style=color:#bbb> </span><span style=background-color:#fff0f0>&#39;123456&#39;</span>),(<span style=color:#00d;font-weight:700>2</span>,<span style=color:#bbb> </span><span style=background-color:#fff0f0>&#39;张三&#39;</span>,<span style=color:#bbb> </span><span style=background-color:#fff0f0>&#39;123456&#39;</span>),(<span style=color:#00d;font-weight:700>3</span>,<span style=color:#bbb> </span><span style=background-color:#fff0f0>&#39;李四&#39;</span>,<span style=color:#bbb> </span><span style=background-color:#fff0f0>&#39;123890&#39;</span>);<span style=color:#bbb>
</span></code></pre></div><h2 id=22-创建一个模板>2.2 创建一个模板</h2>
<ul>
<li>编写mybatis的核心配置文件</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#579>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style=color:#579>&lt;!DOCTYPE configuration
</span><span style=color:#579>        PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span><span style=color:#579>        &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>

<span style=color:#888>&lt;!--核心配置文件--&gt;</span>
<span style=color:#070>&lt;configuration&gt;</span>

    <span style=color:#070>&lt;environments</span> <span style=color:#00c>default=</span><span style=background-color:#fff0f0>&#34;development&#34;</span><span style=color:#070>&gt;</span>
        <span style=color:#070>&lt;environment</span> <span style=color:#00c>id=</span><span style=background-color:#fff0f0>&#34;development&#34;</span><span style=color:#070>&gt;</span>
            <span style=color:#070>&lt;transactionManager</span> <span style=color:#00c>type=</span><span style=background-color:#fff0f0>&#34;JDBC&#34;</span><span style=color:#070>/&gt;</span>
            <span style=color:#070>&lt;dataSource</span> <span style=color:#00c>type=</span><span style=background-color:#fff0f0>&#34;POOLED&#34;</span><span style=color:#070>&gt;</span>
                <span style=color:#070>&lt;property</span> <span style=color:#00c>name=</span><span style=background-color:#fff0f0>&#34;driver&#34;</span> <span style=color:#00c>value=</span><span style=background-color:#fff0f0>&#34;com.mysql.jdbc.Driver&#34;</span><span style=color:#070>/&gt;</span>
                <span style=color:#070>&lt;property</span> <span style=color:#00c>name=</span><span style=background-color:#fff0f0>&#34;url&#34;</span> <span style=color:#00c>value=</span><span style=background-color:#fff0f0>&#34;jdbc:mysql://sh-cdb-b11akhd4.sql.tencentcdb.com:60170/mybatis?useSSL=true&amp;amp;useUnicode=true&amp;amp;characterEncoding=UTF-8&#34;</span><span style=color:#070>/&gt;</span>
                <span style=color:#070>&lt;property</span> <span style=color:#00c>name=</span><span style=background-color:#fff0f0>&#34;username&#34;</span> <span style=color:#00c>value=</span><span style=background-color:#fff0f0>&#34;root&#34;</span><span style=color:#070>/&gt;</span>
                <span style=color:#070>&lt;property</span> <span style=color:#00c>name=</span><span style=background-color:#fff0f0>&#34;password&#34;</span> <span style=color:#00c>value=</span><span style=background-color:#fff0f0>&#34;mxqs6689**&#34;</span><span style=color:#070>/&gt;</span>
            <span style=color:#070>&lt;/dataSource&gt;</span>
        <span style=color:#070>&lt;/environment&gt;</span>
    <span style=color:#070>&lt;/environments&gt;</span>

<span style=color:#070>&lt;/configuration&gt;</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#888>//sqlSessionFactory --&gt; sqlSession
</span><span style=color:#888></span><span style=color:#080;font-weight:700>public</span> <span style=color:#080;font-weight:700>class</span> <span style=color:#b06;font-weight:700>MybatisUtils</span> <span style=color:#333>{</span>

    <span style=color:#080;font-weight:700>private</span> <span style=color:#080;font-weight:700>static</span> SqlSessionFactory sqlSessionFactory<span style=color:#333>;</span>

    <span style=color:#080;font-weight:700>static</span> <span style=color:#333>{</span>
        <span style=color:#080;font-weight:700>try</span> <span style=color:#333>{</span>
            <span style=color:#888>//使用Mybatis
</span><span style=color:#888></span>            <span style=color:#888>// 第一步：获取sqlSessionFactory对象
</span><span style=color:#888></span>            String resource <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#34;mybatis-config.xml&#34;</span><span style=color:#333>;</span>
            InputStream inputStream <span style=color:#333>=</span> Resources<span style=color:#333>.</span><span style=color:#00c>getResourceAsStream</span><span style=color:#333>(</span>resource<span style=color:#333>);</span>
            sqlSessionFactory <span style=color:#333>=</span> <span style=color:#080;font-weight:700>new</span> SqlSessionFactoryBuilder<span style=color:#333>().</span><span style=color:#00c>build</span><span style=color:#333>(</span>inputStream<span style=color:#333>);</span>
        <span style=color:#333>}</span> <span style=color:#080;font-weight:700>catch</span> <span style=color:#333>(</span>IOException e<span style=color:#333>)</span> <span style=color:#333>{</span>
            e<span style=color:#333>.</span><span style=color:#00c>printStackTrace</span><span style=color:#333>();</span>
        <span style=color:#333>}</span>
    <span style=color:#333>}</span>

    <span style=color:#888>//既然有了 SqlSessionFactory，顾名思义，我们可以从中获得 SqlSession 的实例。
</span><span style=color:#888></span>    <span style=color:#888>// SqlSession 提供了在数据库执行 SQL 命令所需的所有方法。你可以通过 SqlSession 实例来直接执行已映射的 SQL 语句
</span><span style=color:#888></span>
    <span style=color:#080;font-weight:700>public</span> <span style=color:#080;font-weight:700>static</span> SqlSession <span style=color:#06b;font-weight:700>getSqlSession</span><span style=color:#333>()</span> <span style=color:#333>{</span>
        <span style=color:#080;font-weight:700>return</span> sqlSessionFactory<span style=color:#333>.</span><span style=color:#00c>openSession</span><span style=color:#333>();</span>

    <span style=color:#333>}</span>
<span style=color:#333>}</span>
</code></pre></div><h2 id=23-编写代码>2.3 编写代码</h2>
<ul>
<li>实体类</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#888>// 实体类
</span><span style=color:#888></span><span style=color:#080;font-weight:700>public</span> <span style=color:#080;font-weight:700>class</span> <span style=color:#b06;font-weight:700>User</span> <span style=color:#333>{</span>
    <span style=color:#080;font-weight:700>private</span> <span style=color:#339;font-weight:700>int</span> id<span style=color:#333>;</span>
    <span style=color:#080;font-weight:700>private</span> String name<span style=color:#333>;</span>
    <span style=color:#080;font-weight:700>private</span> String pwd<span style=color:#333>;</span>

    <span style=color:#080;font-weight:700>public</span> <span style=color:#06b;font-weight:700>User</span><span style=color:#333>()</span> <span style=color:#333>{</span>
    <span style=color:#333>}</span>

    <span style=color:#080;font-weight:700>public</span> <span style=color:#06b;font-weight:700>User</span><span style=color:#333>(</span><span style=color:#339;font-weight:700>int</span> id<span style=color:#333>,</span> String name<span style=color:#333>,</span> String pwd<span style=color:#333>)</span> <span style=color:#333>{</span>
        <span style=color:#080;font-weight:700>this</span><span style=color:#333>.</span><span style=color:#00c>id</span> <span style=color:#333>=</span> id<span style=color:#333>;</span>
        <span style=color:#080;font-weight:700>this</span><span style=color:#333>.</span><span style=color:#00c>name</span> <span style=color:#333>=</span> name<span style=color:#333>;</span>
        <span style=color:#080;font-weight:700>this</span><span style=color:#333>.</span><span style=color:#00c>pwd</span> <span style=color:#333>=</span> pwd<span style=color:#333>;</span>
    <span style=color:#333>}</span>

    <span style=color:#080;font-weight:700>public</span> <span style=color:#339;font-weight:700>int</span> <span style=color:#06b;font-weight:700>getId</span><span style=color:#333>()</span> <span style=color:#333>{</span>
        <span style=color:#080;font-weight:700>return</span> id<span style=color:#333>;</span>
    <span style=color:#333>}</span>

    <span style=color:#080;font-weight:700>public</span> <span style=color:#339;font-weight:700>void</span> <span style=color:#06b;font-weight:700>setId</span><span style=color:#333>(</span><span style=color:#339;font-weight:700>int</span> id<span style=color:#333>)</span> <span style=color:#333>{</span>
        <span style=color:#080;font-weight:700>this</span><span style=color:#333>.</span><span style=color:#00c>id</span> <span style=color:#333>=</span> id<span style=color:#333>;</span>
    <span style=color:#333>}</span>

    <span style=color:#080;font-weight:700>public</span> String <span style=color:#06b;font-weight:700>getName</span><span style=color:#333>()</span> <span style=color:#333>{</span>
        <span style=color:#080;font-weight:700>return</span> name<span style=color:#333>;</span>
    <span style=color:#333>}</span>

    <span style=color:#080;font-weight:700>public</span> <span style=color:#339;font-weight:700>void</span> <span style=color:#06b;font-weight:700>setName</span><span style=color:#333>(</span>String name<span style=color:#333>)</span> <span style=color:#333>{</span>
        <span style=color:#080;font-weight:700>this</span><span style=color:#333>.</span><span style=color:#00c>name</span> <span style=color:#333>=</span> name<span style=color:#333>;</span>
    <span style=color:#333>}</span>

    <span style=color:#080;font-weight:700>public</span> String <span style=color:#06b;font-weight:700>getPwd</span><span style=color:#333>()</span> <span style=color:#333>{</span>
        <span style=color:#080;font-weight:700>return</span> pwd<span style=color:#333>;</span>
    <span style=color:#333>}</span>

    <span style=color:#080;font-weight:700>public</span> <span style=color:#339;font-weight:700>void</span> <span style=color:#06b;font-weight:700>setPwd</span><span style=color:#333>(</span>String pwd<span style=color:#333>)</span> <span style=color:#333>{</span>
        <span style=color:#080;font-weight:700>this</span><span style=color:#333>.</span><span style=color:#00c>pwd</span> <span style=color:#333>=</span> pwd<span style=color:#333>;</span>
    <span style=color:#333>}</span>

    <span style=color:#555;font-weight:700>@Override</span>
    <span style=color:#080;font-weight:700>public</span> String <span style=color:#06b;font-weight:700>toString</span><span style=color:#333>()</span> <span style=color:#333>{</span>
        <span style=color:#080;font-weight:700>return</span> <span style=background-color:#fff0f0>&#34;User{&#34;</span> <span style=color:#333>+</span>
                <span style=background-color:#fff0f0>&#34;id=&#34;</span> <span style=color:#333>+</span> id <span style=color:#333>+</span>
                <span style=background-color:#fff0f0>&#34;, name=&#39;&#34;</span> <span style=color:#333>+</span> name <span style=color:#333>+</span> <span style=color:#04d;background-color:#fff0f0>&#39;\&#39;&#39;</span> <span style=color:#333>+</span>
                <span style=background-color:#fff0f0>&#34;, pwd=&#39;&#34;</span> <span style=color:#333>+</span> pwd <span style=color:#333>+</span> <span style=color:#04d;background-color:#fff0f0>&#39;\&#39;&#39;</span> <span style=color:#333>+</span>
                <span style=color:#04d;background-color:#fff0f0>&#39;}&#39;</span><span style=color:#333>;</span>
    <span style=color:#333>}</span>
<span style=color:#333>}</span>
</code></pre></div><ul>
<li>Dao接口</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#080;font-weight:700>public</span> <span style=color:#080;font-weight:700>interface</span> <span style=color:#b06;font-weight:700>UserDao</span> <span style=color:#333>{</span>
    List<span style=color:#333>&lt;</span>User<span style=color:#333>&gt;</span> <span style=color:#06b;font-weight:700>getUserList</span><span style=color:#333>();</span>
<span style=color:#333>}</span>
</code></pre></div><ul>
<li>接口实现类由原来的UserDaoImpl转变为一个Mapper配置文件。</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#579>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style=color:#579>&lt;!DOCTYPE mapper
</span><span style=color:#579>        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span><span style=color:#579>        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>

<span style=color:#888>&lt;!--namespace=绑定一个对应的Dao/Mapper/接口--&gt;</span>
<span style=color:#070>&lt;mapper</span> <span style=color:#00c>namespace=</span><span style=background-color:#fff0f0>&#34;com.heng.dao.UserDao&#34;</span><span style=color:#070>&gt;</span>
    <span style=color:#070>&lt;select</span> <span style=color:#00c>id=</span><span style=background-color:#fff0f0>&#34;getUserList&#34;</span> <span style=color:#00c>resultType=</span><span style=background-color:#fff0f0>&#34;com.heng.pojo.User&#34;</span><span style=color:#070>&gt;</span>
        SELECT * FROM mybatis.user;
    <span style=color:#070>&lt;/select&gt;</span>
<span style=color:#070>&lt;/mapper&gt;</span>
</code></pre></div><h2 id=24-测试>2.4 测试</h2>
<p>注意点：org.apache.ibatis.binding.BindingException: Type interface com.heng.dao.UserDao is not known to the MapperRegistry.</p>
<p><strong>MapperRegistry是什么？</strong></p>
<p>核心文件中注册mappers。</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#888>&lt;!--在build中配置resources，来防止资源导入失败的问题--&gt;</span>
    <span style=color:#070>&lt;build&gt;</span>
        <span style=color:#070>&lt;resources&gt;</span>
            <span style=color:#070>&lt;resource&gt;</span>
                <span style=color:#070>&lt;directory&gt;</span>src/main/resources<span style=color:#070>&lt;/directory&gt;</span>
                <span style=color:#070>&lt;includes&gt;</span>
                    <span style=color:#070>&lt;include&gt;</span>**/*.properties<span style=color:#070>&lt;/include&gt;</span>
                    <span style=color:#070>&lt;include&gt;</span>**/*.xml<span style=color:#070>&lt;/include&gt;</span>
                <span style=color:#070>&lt;/includes&gt;</span>
                <span style=color:#070>&lt;filtering&gt;</span>true<span style=color:#070>&lt;/filtering&gt;</span>
            <span style=color:#070>&lt;/resource&gt;</span>
            <span style=color:#070>&lt;resource&gt;</span>
                <span style=color:#070>&lt;directory&gt;</span>src/main/java<span style=color:#070>&lt;/directory&gt;</span>
                <span style=color:#070>&lt;includes&gt;</span>
                    <span style=color:#070>&lt;include&gt;</span>**/*.properties<span style=color:#070>&lt;/include&gt;</span>
                    <span style=color:#070>&lt;include&gt;</span>**/*.xml<span style=color:#070>&lt;/include&gt;</span>
                <span style=color:#070>&lt;/includes&gt;</span>
                <span style=color:#070>&lt;filtering&gt;</span>true<span style=color:#070>&lt;/filtering&gt;</span>
            <span style=color:#070>&lt;/resource&gt;</span>
        <span style=color:#070>&lt;/resources&gt;</span>
    <span style=color:#070>&lt;/build&gt;</span>
</code></pre></div><ul>
<li>junit测试</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#555;font-weight:700>@Test</span>
    <span style=color:#080;font-weight:700>public</span> <span style=color:#339;font-weight:700>void</span> <span style=color:#06b;font-weight:700>test</span><span style=color:#333>()</span> <span style=color:#333>{</span>

        <span style=color:#888>// 第一步：获取sqlSession对象
</span><span style=color:#888></span>        SqlSession sqlSession <span style=color:#333>=</span> MybatisUtils<span style=color:#333>.</span><span style=color:#00c>getSqlSession</span><span style=color:#333>();</span>

        <span style=color:#888>// 方式一：getMapper
</span><span style=color:#888></span>        UserDao mapper <span style=color:#333>=</span> sqlSession<span style=color:#333>.</span><span style=color:#00c>getMapper</span><span style=color:#333>(</span>UserDao<span style=color:#333>.</span><span style=color:#00c>class</span><span style=color:#333>);</span>
        List<span style=color:#333>&lt;</span>User<span style=color:#333>&gt;</span> userList <span style=color:#333>=</span> mapper<span style=color:#333>.</span><span style=color:#00c>getUserList</span><span style=color:#333>();</span>




        <span style=color:#080;font-weight:700>for</span> <span style=color:#333>(</span>User user<span style=color:#333>:</span> userList<span style=color:#333>)</span> <span style=color:#333>{</span>
            System<span style=color:#333>.</span><span style=color:#00c>out</span><span style=color:#333>.</span><span style=color:#00c>println</span><span style=color:#333>(</span>user<span style=color:#333>);</span>
        <span style=color:#333>}</span>

        <span style=color:#888>// 关闭sqlSession
</span><span style=color:#888></span>        sqlSession<span style=color:#333>.</span><span style=color:#00c>close</span><span style=color:#333>();</span>
    <span style=color:#333>}</span>
</code></pre></div><p>可能会遇到的问题：</p>
<ol>
<li>配置文件没有注册</li>
<li>绑定接口错误</li>
<li>方法名不对</li>
<li>返回类型不对</li>
<li>Maven 导出资源问题</li>
</ol>
<h1 id=3-crudcreateretrieveupdatedelete>3 CRUD（Create，Retrieve，Update，Delete）</h1>
<h2 id=31-namespace>3.1 namespace</h2>
<p>namespace中的包名要和 Dao/Mapper 接口的包名一致</p>
<h2 id=32-select>3.2 select</h2>
<p>选择，查询语句；</p>
<ul>
<li>id：就是对应的namespace中的方法名；</li>
<li>resultType：Sql语句执行的返回值！</li>
<li>parametType：参数类型！</li>
</ul>
<ol>
<li>编写接口</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#888>// 根据ID查询用户
</span><span style=color:#888></span>    User <span style=color:#06b;font-weight:700>getUserById</span><span style=color:#333>(</span><span style=color:#339;font-weight:700>int</span> id<span style=color:#333>);</span>
</code></pre></div><ol start=2>
<li>编写对应的Mapper中的sql语句</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#070>&lt;select</span> <span style=color:#00c>id=</span><span style=background-color:#fff0f0>&#34;getUserById&#34;</span> <span style=color:#00c>parameterType=</span><span style=background-color:#fff0f0>&#34;int&#34;</span> <span style=color:#00c>resultType=</span><span style=background-color:#fff0f0>&#34;com.heng.pojo.User&#34;</span><span style=color:#070>&gt;</span>
        SELECT * FROM demo_siahk.user WHERE id = #{id};
<span style=color:#070>&lt;/select&gt;</span>
</code></pre></div><ol start=3>
<li>测试</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#555;font-weight:700>@Test</span>
<span style=color:#080;font-weight:700>public</span> <span style=color:#339;font-weight:700>void</span> <span style=color:#06b;font-weight:700>getUserById</span><span style=color:#333>(){</span>
    SqlSession sqlSession <span style=color:#333>=</span> MybatisUtils<span style=color:#333>.</span><span style=color:#00c>getSqlSession</span><span style=color:#333>();</span>

    UserMapper mapper <span style=color:#333>=</span> sqlSession<span style=color:#333>.</span><span style=color:#00c>getMapper</span><span style=color:#333>(</span>UserMapper<span style=color:#333>.</span><span style=color:#00c>class</span><span style=color:#333>);</span>
    User user <span style=color:#333>=</span> mapper<span style=color:#333>.</span><span style=color:#00c>getUserById</span><span style=color:#333>(</span>2<span style=color:#333>);</span>

    System<span style=color:#333>.</span><span style=color:#00c>out</span><span style=color:#333>.</span><span style=color:#00c>println</span><span style=color:#333>(</span>user<span style=color:#333>);</span>

    sqlSession<span style=color:#333>.</span><span style=color:#00c>close</span><span style=color:#333>();</span>
<span style=color:#333>}</span>
</code></pre></div><h2 id=33-insert>3.3 insert</h2>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#070>&lt;insert</span> <span style=color:#00c>id=</span><span style=background-color:#fff0f0>&#34;addUser&#34;</span> <span style=color:#00c>parameterType=</span><span style=background-color:#fff0f0>&#34;com.heng.pojo.User&#34;</span><span style=color:#070>&gt;</span>
    INSERT INTO demo_siahk.user (id, name, pwd) VALUES (#{id},#{name},#{pwd});
<span style=color:#070>&lt;/insert&gt;</span>
</code></pre></div><h2 id=34-update>3.4 update</h2>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#070>&lt;update</span> <span style=color:#00c>id=</span><span style=background-color:#fff0f0>&#34;updateUser&#34;</span> <span style=color:#00c>parameterType=</span><span style=background-color:#fff0f0>&#34;com.heng.pojo.User&#34;</span><span style=color:#070>&gt;</span>
    update demo_siahk.user
    set name = #{name}, pwd = #{pwd}
    where id = #{id};
<span style=color:#070>&lt;/update&gt;</span>
</code></pre></div><h2 id=35-delete>3.5 delete</h2>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#070>&lt;delete</span> <span style=color:#00c>id=</span><span style=background-color:#fff0f0>&#34;deleteUser&#34;</span> <span style=color:#00c>parameterType=</span><span style=background-color:#fff0f0>&#34;int&#34;</span><span style=color:#070>&gt;</span>
    delete from demo_siahk.user where id = #{id};
<span style=color:#070>&lt;/delete&gt;</span>
</code></pre></div><p>注意点：</p>
<ul>
<li>增删改需要提交事务</li>
</ul>
<h2 id=36-分析错误>3.6 分析错误</h2>
<ul>
<li>标签不要匹配错</li>
<li>resource 使用 mapper 需要使用路径</li>
<li>程序配置文件必须符合规范</li>
<li>NullPointException，没有注册到资源</li>
<li>输出的xml文件中存在中文乱码问题</li>
<li>maven资源没有导出问题</li>
</ul>
<h2 id=37-map>3.7 Map</h2>
<p>假如实体类或者数据库中的表的字段或参数过多，考虑使用map。</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#339;font-weight:700>int</span> <span style=color:#06b;font-weight:700>addUser2</span><span style=color:#333>(</span>Map<span style=color:#333>&lt;</span>String<span style=color:#333>,</span> Object<span style=color:#333>&gt;</span> map<span style=color:#333>);</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>    <span style=color:#070>&lt;insert</span> <span style=color:#00c>id=</span><span style=background-color:#fff0f0>&#34;addUser2&#34;</span> <span style=color:#00c>parameterType=</span><span style=background-color:#fff0f0>&#34;map&#34;</span><span style=color:#070>&gt;</span>
        INSERT INTO demo_siahk.user (id, name, pwd) VALUES (#{userId},#{userName},#{password});
    <span style=color:#070>&lt;/insert&gt;</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#555;font-weight:700>@Test</span>
    <span style=color:#080;font-weight:700>public</span> <span style=color:#339;font-weight:700>void</span> <span style=color:#06b;font-weight:700>addUser2</span><span style=color:#333>()</span> <span style=color:#333>{</span>
        SqlSession sqlSession <span style=color:#333>=</span> MybatisUtils<span style=color:#333>.</span><span style=color:#00c>getSqlSession</span><span style=color:#333>();</span>

        UserMapper mapper <span style=color:#333>=</span> sqlSession<span style=color:#333>.</span><span style=color:#00c>getMapper</span><span style=color:#333>(</span>UserMapper<span style=color:#333>.</span><span style=color:#00c>class</span><span style=color:#333>);</span>

        Map<span style=color:#333>&lt;</span>String<span style=color:#333>,</span> Object<span style=color:#333>&gt;</span> map <span style=color:#333>=</span> <span style=color:#080;font-weight:700>new</span> HashMap<span style=color:#333>&lt;</span>String<span style=color:#333>,</span> Object<span style=color:#333>&gt;();</span>

        map<span style=color:#333>.</span><span style=color:#00c>put</span><span style=color:#333>(</span><span style=background-color:#fff0f0>&#34;userId&#34;</span><span style=color:#333>,</span> 5<span style=color:#333>);</span>
        map<span style=color:#333>.</span><span style=color:#00c>put</span><span style=color:#333>(</span><span style=background-color:#fff0f0>&#34;userName&#34;</span><span style=color:#333>,</span> <span style=background-color:#fff0f0>&#34;Hello&#34;</span><span style=color:#333>);</span>
        map<span style=color:#333>.</span><span style=color:#00c>put</span><span style=color:#333>(</span><span style=background-color:#fff0f0>&#34;password&#34;</span><span style=color:#333>,</span> <span style=background-color:#fff0f0>&#34;122222&#34;</span><span style=color:#333>);</span>

        mapper<span style=color:#333>.</span><span style=color:#00c>addUser2</span><span style=color:#333>(</span>map<span style=color:#333>);</span>

        sqlSession<span style=color:#333>.</span><span style=color:#00c>commit</span><span style=color:#333>();</span>
        sqlSession<span style=color:#333>.</span><span style=color:#00c>close</span><span style=color:#333>();</span>
    <span style=color:#333>}</span>
</code></pre></div><p>Map 传递参数，直接在sql中取出key即可。<code>parameterType="map"</code></p>
<p>对象传递参数，直接在sql取出对象的属性即可。<code>parameterType="Object"</code></p>
<p>只有一个基本类型参数的情况下，可以直接在sql取到。</p>
<p>多个参数用Map，<strong>或者注解</strong></p>
<h2 id=38-思考题>3.8 思考题</h2>
<p>模糊查询怎么写？</p>
<ol>
<li>java代码执行的时候，传递通配符 % %。</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>List<span style=color:#333>&lt;</span>User<span style=color:#333>&gt;</span> userList <span style=color:#333>=</span> mapper<span style=color:#333>.</span><span style=color:#00c>getUserLike</span><span style=color:#333>(</span><span style=background-color:#fff0f0>&#34;%李%&#34;</span><span style=color:#333>);</span>
</code></pre></div><ol start=2>
<li>在sql拼接中使用通配符</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>select * from demo_siahk.user where name like &#34;%&#34;#{value}&#34;%&#34;;
</code></pre></div>
</div>
</div></div>
</main>
<footer>
© Copyright notice | <a href=https://github.com/dataCobra/hugo-vitae>Vitae</a> theme for <a href=https://gohugo.io>Hugo</a>
</footer>
</body>
</html>